(function(){
    window.GN_I18N = {
        translations: {
            en: {
                title_main: 'GymNerd',
                sync_pending: 'â˜ï¸ Sync Pending Changes',
                start_routine: 'ðŸš€ Start Routine',
                menu_start_routine: 'ðŸš€ Start Routine',
                page_start_routine: 'Start Routine',
                routines: 'ðŸ‹ Routines',
                menu_routines: 'ðŸ‹ Routines',
                page_routines: 'Routines',
                history: 'ðŸ“‹ History',
                menu_history: 'ðŸ“‹ History',
                page_history: 'History',
                statistics: 'ðŸ“Š Statistics',
                menu_statistics: 'ðŸ“Š Statistics',
                page_statistics: 'Statistics',
                data_management: 'âš™ï¸ Data Management',
                cloud_sync: 'Cloud Sync',
                sync_to_drive: 'â˜ï¸ Sync to Google Drive',
                restore_from_drive: 'ðŸ“¥ Restore from Google Drive',
                backup: 'Backup',
                export_json: 'ðŸ“¤ Export 4 JSON Files',
                restore: 'Restore',
                label_images: '1. Images Database (.json)',
                label_exercises: '2. Exercises (.json)',
                label_routines: '3. Routines',
                label_history: '4. History (.json)',
                process_import: 'ðŸ“¥ Process Import',
                sign_in_with_google: 'Sign in with Google',

                import_success: 'Import successful!',
                import_error: 'Error importing data. Check console for details.',
                no_backup: 'No backup found on Google Drive.',
                overwrite_confirm: 'This will overwrite all local data with the version from Google Drive. Continue?',
                session_expired: 'Your session has expired. Please login again.',
                restore_failed_prefix: 'Restore failed: ',

                local_mode: 'Local Mode',
                running_local_mode_msg: 'Running in Local Mode.',
                sync_workout_msg: 'Sync your workout data with Google Drive.',
                language: 'Language',
                enter_app: 'Enter App',
                connected_to_drive: 'Connected to Drive',
                clear_all: 'Clear All',
                logout: 'Logout',
                not_connected: 'Not Connected',
                clear_local: 'Clear Local',
                login: 'Login',

                welcome_back_syncing: 'Welcome back! Syncing your data...',
                retry: 'Retry',
                retrying: 'Retrying...',
                failed_to_refresh_session: 'Could not refresh your session automatically. Please sign in again.'
                ,
                /* Statistics page */
                workout_frequency: 'Workout Frequency',
                monthly: 'Monthly',
                yearly: 'Yearly',
                weight_progress: 'Weight Progress',
                no_weight_data: 'No weight data',
                weight_kg: 'Weight (kg)',
                unknown_exercise: 'Unknown Exercise',
                current_streak: 'Current Streak',
                days: 'Days',
                start_your_journey: 'Start your journey!',
                best_record: 'Best Record',
                no_records_yet: 'No records yet',
                keep_it_up: 'Keep it up!',
                days_since_last: 'days since last',
                personal_best: 'Personal Best'
                ,
                /* Exercise types */
                exercise_type_shoulder: 'Shoulder',
                exercise_type_chest: 'Chest',
                exercise_type_back: 'Back',
                exercise_type_legs: 'Legs',
                exercise_type_arms: 'Arms',
                exercise_type_leg: 'Legs',
                exercise_type_arm: 'Arms',
                exercise_type_core: 'Core',
                exercise_type_cardio: 'Cardio',
                exercise_type_mobility: 'Mobility',
                exercise_type_strength: 'Strength',
                exercise_type_other: 'Other'
                ,
                /* History page specific keys (unique names) */
                history_header: 'History',
                history_btn_new_routine: 'New Routine Entry',
                history_btn_new_weight: 'New Weight Entry',
                history_section_log_routine: 'Log Routine',
                history_section_log_weight: 'Log Weight',
                history_placeholder_choose_routine: '-- Choose Routine --',
                history_save_session: 'ðŸ’¾ Save Session',
                history_save_weight: 'ðŸ’¾ Save Weight',
                history_cancel: 'Cancel',
                history_weight_kg: 'Weight (kg)',
                history_weight_saved: 'Weight saved!',
                history_sets: 'Sets',
                history_kg: 'Kg',
                history_reps: 'Reps',
                history_delete_session: 'Delete Session',
                history_confirm_delete: 'Delete all entries for {date}?',
                history_fmt_sets_short: 'sets',
                history_fmt_kg_suffix: 'kg'
                ,
                /* Livesession specific */
                resume_unfinished: 'ðŸƒ Unfinished session found',
                resume_continue: 'Continue',
                resume_discard: 'Discard',
                label_select_routine: 'Select a Routine',
                choose_routine_placeholder: '-- Choose Routine --',
                start_session: 'ðŸš€ Start Session',
                play_exercise: 'ðŸŽ¯ Play this exercise',
                finish_routine: 'ðŸ Finish Routine',
                reset_timer: 'Reset Timer',
                previous_exercise: 'Previous Exercise',
                next_exercise: 'Next Exercise',
                previous_set: 'Previous Set',
                skip_set: 'Skip Set',
                complete_set: 'Complete Set',
                please_select_exercise: 'Please select at least one exercise.',
                discard_confirm: 'Discard unfinished routine?',
                skip_exercise_confirm: 'Skip the rest of this exercise?',
                new_streak_record: 'ðŸŽ‰ NEW STREAK RECORD: {n} DAYS!',
                debug_error_prefix: 'DEBUG ERROR: '
                ,
                drag_to_reorder: 'Drag to reorder'
            },
            pt: {
                title_main: 'GymNerd',
                sync_pending: 'â˜ï¸ AlteraÃ§Ãµes pendentes',
                start_routine: 'ðŸš€ Iniciar Treino',
                menu_start_routine: 'ðŸš€ Iniciar Treino',
                page_start_routine: 'Iniciar Treino',
                routines: 'ðŸ‹ Rotinas',
                menu_routines: 'ðŸ‹ Rotinas',
                page_routines: 'Rotinas',
                history: 'ðŸ“‹ HistÃ³rico',
                menu_history: 'ðŸ“‹ HistÃ³rico',
                page_history: 'HistÃ³rico',
                statistics: 'ðŸ“Š EstatÃ­sticas',
                menu_statistics: 'ðŸ“Š EstatÃ­sticas',
                page_statistics: 'EstatÃ­sticas',
                data_management: 'âš™ï¸ Gerenciar Dados',
                cloud_sync: 'SincronizaÃ§Ã£o com a Nuvem',
                sync_to_drive: 'â˜ï¸ Sincronizar com Google Drive',
                restore_from_drive: 'ðŸ“¥ Restaurar do Google Drive',
                backup: 'Backup',
                export_json: 'ðŸ“¤ Exportar 4 arquivos JSON',
                restore: 'Restaurar',
                label_images: '1. Banco de Imagens (.json)',
                label_exercises: '2. ExercÃ­cios (.json)',
                label_routines: '3. Rotinas',
                label_history: '4. HistÃ³rico',
                process_import: 'ðŸ“¥ Processar ImportaÃ§Ã£o',
                sign_in_with_google: 'Entrar com o Google',

                import_success: 'ImportaÃ§Ã£o bem-sucedida!',
                import_error: 'Erro ao importar dados. Verifique o console para detalhes.',
                no_backup: 'Nenhum backup encontrado no Google Drive.',
                overwrite_confirm: 'Isto irÃ¡ sobrescrever todos os dados locais com a versÃ£o do Google Drive. Continuar?',
                session_expired: 'Sua sessÃ£o expirou. Por favor, entre novamente.',
                restore_failed_prefix: 'Falha ao restaurar: ',

                local_mode: 'Modo Local',
                running_local_mode_msg: 'Rodando em modo local.',
                sync_workout_msg: 'Sincronize seus treinos com o Google Drive.',
                language: 'Idioma',
                enter_app: 'Entrar no App',
                connected_to_drive: 'Conectado ao Drive',
                clear_all: 'Limpar Tudo',
                logout: 'Sair',
                not_connected: 'NÃ£o Conectado',
                clear_local: 'Limpar Local',
                login: 'Entrar',

                welcome_back_syncing: 'Bem vindo de volta! Sincronizando seus dados...',
                retry: 'Tentar novamente',
                retrying: 'Tentando...',
                failed_to_refresh_session: 'NÃ£o foi possÃ­vel atualizar sua sessÃ£o automaticamente. Por favor, entre novamente.'
                ,
                /* Statistics page */
                workout_frequency: 'FrequÃªncia de Treinos',
                monthly: 'Mensal',
                yearly: 'Anual',
                weight_progress: 'Progresso de Peso',
                no_weight_data: 'Sem dados de peso',
                weight_kg: 'Peso (kg)',
                unknown_exercise: 'ExercÃ­cio Desconhecido',
                current_streak: 'SequÃªncia Atual',
                days: 'Dias',
                start_your_journey: 'Comece sua jornada!',
                best_record: 'Melhor Recorde',
                no_records_yet: 'Nenhum registro ainda',
                keep_it_up: 'Mantenha assim!',
                days_since_last: 'dias desde o Ãºltimo',
                personal_best: 'Recorde Pessoal'
                ,
                /* Exercise types */
                exercise_type_shoulder: 'Ombros',
                exercise_type_chest: 'Peito',
                exercise_type_back: 'Costas',
                exercise_type_legs: 'Pernas',
                exercise_type_arms: 'BraÃ§os',
                exercise_type_leg: 'Pernas',
                exercise_type_arm: 'BraÃ§os',
                exercise_type_core: 'Core',
                exercise_type_cardio: 'Cardio',
                exercise_type_mobility: 'Mobilidade',
                exercise_type_strength: 'ForÃ§a',
                exercise_type_other: 'Outro'
                ,
                /* History page specific keys (unique names) */
                history_header: 'HistÃ³rico',
                history_btn_new_routine: 'Novo Registro de Rotina',
                history_btn_new_weight: 'Novo Registro de Peso',
                history_section_log_routine: 'Registrar Treino',
                history_section_log_weight: 'Registrar Peso',
                history_placeholder_choose_routine: '-- Escolha a Rotina --',
                history_save_session: 'ðŸ’¾ Salvar SessÃ£o',
                history_save_weight: 'ðŸ’¾ Salvar Peso',
                history_cancel: 'Cancelar',
                history_weight_kg: 'Peso (kg)',
                history_weight_saved: 'Peso salvo!',
                history_sets: 'SÃ©ries',
                history_kg: 'Kg',
                history_reps: 'RepetiÃ§Ãµes',
                history_delete_session: 'Excluir SessÃ£o',
                history_confirm_delete: 'Excluir todas as entradas para {date}?',
                history_fmt_sets_short: 'sÃ©r',
                history_fmt_kg_suffix: 'kg'
                ,
                /* Livesession specific */
                resume_unfinished: 'ðŸƒ SessÃ£o incompleta encontrada',
                resume_continue: 'Continuar',
                resume_discard: 'Descartar',
                label_select_routine: 'Selecione uma Rotina',
                choose_routine_placeholder: '-- Escolha a Rotina --',
                start_session: 'ðŸš€ Iniciar SessÃ£o',
                play_exercise: 'ðŸŽ¯ Executar este exercÃ­cio',
                finish_routine: 'ðŸ Finalizar Rotina',
                reset_timer: 'Redefinir Temporizador',
                previous_exercise: 'ExercÃ­cio Anterior',
                next_exercise: 'PrÃ³ximo ExercÃ­cio',
                previous_set: 'SÃ©rie Anterior',
                skip_set: 'Pular SÃ©rie',
                complete_set: 'Completar SÃ©rie',
                please_select_exercise: 'Por favor selecione pelo menos um exercÃ­cio.',
                discard_confirm: 'Descartar rotina incompleta?',
                skip_exercise_confirm: 'Pular o resto deste exercÃ­cio?',
                new_streak_record: 'ðŸŽ‰ NOVO RECORDE DE SEQUÃŠNCIA: {n} DIAS!',
                debug_error_prefix: 'ERRO DE DEBUG: '
                ,
                drag_to_reorder: 'Arraste para reordenar'
            }
        },
        getLang: function(){
            try {
                const stored = localStorage.getItem('gn_lang');
                if (stored) return stored;
                return (navigator.language || navigator.userLanguage || 'en').toLowerCase().startsWith('pt') ? 'pt' : 'en';
            } catch(e){ return 'en'; }
        },
        t: function(key){
            const lang = this.getLang();
            return (this.translations[lang] && this.translations[lang][key]) || key;
        },
        localizeExerciseType: function(type){
            if (!type) return type;
            try {
                const key = 'exercise_type_' + type.replace(/\s+/g, '_').toLowerCase();
                const translated = this.t(key);
                if (translated && translated !== key) return translated;
            } catch(e){}
            return type;
        },
        applyTranslations: function(root){
            try{
                root = root || document;
                const nodes = root.querySelectorAll('[data-i18n]');
                nodes.forEach(n => {
                    const key = n.getAttribute('data-i18n');
                    const val = this.t(key);
                    if (n.tagName === 'INPUT' || n.tagName === 'TEXTAREA') {
                        if (n.hasAttribute('placeholder')) n.placeholder = val;
                        else n.value = val;
                    } else {
                        n.textContent = val;
                    }
                });
                // placeholders
                const phs = root.querySelectorAll('[data-i18n-placeholder]');
                phs.forEach(n => {
                    const key = n.getAttribute('data-i18n-placeholder');
                    n.placeholder = this.t(key);
                });
            }catch(e){ console.warn('i18n apply failed', e); }
        }
    };
})();
